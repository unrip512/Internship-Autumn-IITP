# Wastie_REST_API

REST_API для ПО Wastie


main.py - код работы сервера REST API интерфейса,в котором симулируется работа набора клапанов.
Содержит два класса - GateLogger и System.

1) Класс GateLogger хранит историю работы системы, а именно массив tmp из 64 целых чисел, 
  равных кол-ву срабатываний каждого из клапанов(до запуска процесса - массив нулей). 
У класса есть две функции: 
- log_trigger -  вносит изменения в массив tmp при срабатывании клапана. 
- gate_state - принимает на вход  gate_id - номер клапана (целое число от 1 до 64 включительно) и возвращает колличество срабатываний этого клапана (клапана с номером gate_id). Если подать на вход
		gate_id = 0, то вернет массив с колличеством срабатываний всех клапанов.
		
2) Класс System соответствует процессу работы системы. Содеждит:
	 - logger - объект класса GateLogger
	 - gate_process - процесс, в котором будет работать фунция _gate_thread() (gate_process - объект класса Process() модуля multiprocessing)
     - _gate_thread() - функция работы системы (процесс который запускает клапаны).
       
       Алгоритм:
       1) Процесс уходит в sleep на время от 1 до 10 секунд которое генерируется случайно
       2) Затем происходит генерация рандомного числа gates_count от 0 до 64 - это количество клапанов, которое сработает
       3) Затем происходит генерация gates_count рандомных целых различных чисел от 0 до 63 это номера клапанов которые сработают
 	 
   - start() - функция запуска процесса
   - stop() - функция остановки процесса (return: 0 - если процесс еще работал, но был приостановлен
                         1 - если процесс вообще не создавался и не запускался
                         2 - если процесс был, но уже завершился сам)

При запуске кода объект класса System создается автоматически. При взаимодействии с сервером клиент может подать три типа запроса:
- post("/api/start") - запускает процесс работы клапанов и говорит об этом клиенту. 
- get("/api/system_condition") - принимает переменную gate_id (от 1 до 64 включительно)и возвращает кол-во срабатываний 
		клапана с этим номером или же массив срабатываний всех клапанов, если gate_id = 0
		(Из грустного: чтобы запросить кол-во срабатываний какого-то из клапанов, нужно сначала остановить процесс и только потом запрашивать. Иначе не скажет.
 		Потом его можно снова запустить, история не обнулится, но все же.) 
- put("/api/stop") - останавливает процесс работы, возвращает 0, 1 или 2 (аналогично фунции stop() класса System)
	
